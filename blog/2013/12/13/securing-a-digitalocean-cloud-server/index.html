
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Securing a DigitalOcean Cloud Server - ALEX BABAN</title>
  <meta name="author" content="Alex Baban">

  
  <meta name="description" content="I like DigitalOcean. It&rsquo;s one of my playgrounds. I spin up a virtual server, make a mess for a few hours then destroy it. The cost: $0.03 for &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.alexbaban.com/blog/2013/12/13/securing-a-digitalocean-cloud-server">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="ALEX BABAN" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">ALEX BABAN</a></h1>
  
    <h2>my thoughts on tech, web development, etc.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.alexbaban.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Securing a DigitalOcean Cloud Server</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-13T11:54:19-08:00" pubdate data-updated="true">Dec 13<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><h3>I like DigitalOcean. It&rsquo;s one of my playgrounds. I spin up a virtual server, make a mess for a few hours then destroy it. The cost: $0.03 for about 4 hours of fun.</h3>

<p>But not all my virtual servers are short lived. Some, I need them up for a few days or weeks, some even longer. Here is what I do to secure a DigitalOcean virtual server.</p>

<p>Once the server is ready (it really takes about 60 seconds), I login using the &ldquo;Console Access&rdquo; VNC connection that&rsquo;s available on DigitalOcean&rsquo;s user account interface, then:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># change root password</span>
</span><span class='line'>passwd
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># update all packages and operating system</span>
</span><span class='line'>apt-get update <span class="o">&amp;&amp;</span> apt-get --yes upgrade
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># make a backup of sshd_config file, a read-only copy in /etc/ssh </span>
</span><span class='line'>sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.factory-defaults
</span><span class='line'>sudo chmod a-w /etc/ssh/sshd_config.factory-defaults
</span><span class='line'>
</span><span class='line'><span class="c"># edit the sshd_config file in the /etc/ssh directory</span>
</span><span class='line'>nano /etc/ssh/sshd_config
</span><span class='line'>
</span><span class='line'><span class="c"># restrict ssh access by &lt;my ip address&gt;, add line</span>
</span><span class='line'>AllowUsers root@&lt;my ip address&gt;
</span></code></pre></td></tr></table></div></figure>


<p>At this point, I&rsquo;m good to start playing, I mean working. Any SSH access will be denied if the remote ip address doesn&rsquo;t match my ip address. I can also <code>cat /var/log/auth.log | more</code> to check the logs for any hacking attempts.</p>

<p>Sure, there are more techniques (SSH key pairs, configure iptables, use a non-standard port, limit users and groups, TCP wrappers, fail2ban and denyhosts) that can be combined to provide as much security as possible. The <code>sshd_config</code> technique explained above is quick.</p>

<p>Below I will describe how to configure iptables (built in firewall) rules to make ssh stealth. I use this when I expect to keep my virtual server up for more than just a few hours.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># view all iptables rules (none for a new server)</span>
</span><span class='line'>iptables --list
</span><span class='line'>
</span><span class='line'><span class="c"># view iptables rules by number and chain</span>
</span><span class='line'>iptables -L INPUT --line-numbers
</span><span class='line'>
</span><span class='line'><span class="c"># restrict ssh access by ip address</span>
</span><span class='line'>sudo iptables -A INPUT -p tcp --dport 22 -s &lt;my ip address&gt; -j ACCEPT
</span><span class='line'>sudo iptables -A INPUT -p tcp --dport 22 -j REJECT
</span><span class='line'>
</span><span class='line'><span class="c"># also securing Jetty (when installed)</span>
</span><span class='line'>sudo iptables -A INPUT -p tcp --dport 8080 -s 127.0.0.1 -j ACCEPT
</span><span class='line'>sudo iptables -A INPUT -p tcp --dport 8080 -j REJECT
</span><span class='line'>
</span><span class='line'><span class="c"># make firewall rules persistent, save them to a file</span>
</span><span class='line'>sudo sh -c <span class="s2">&quot;iptables-save &gt; /etc/iptables.rules&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># make changes to /etc/network/interfaces</span>
</span><span class='line'>sudo nano /etc/network/interfaces
</span><span class='line'>
</span><span class='line'><span class="c"># at the end of the primary network interface (eth0) config add:</span>
</span><span class='line'>pre-up iptables-restore &lt; /etc/iptables.rules
</span></code></pre></td></tr></table></div></figure>


<p>The best way to secure the ssh daemon and other services is to apply more than one of these methods. Choosing the right ones means weighing security against convenience. Remember to play safe.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Alex Baban</span></span>

      








  


<time datetime="2013-12-13T11:54:19-08:00" pubdate data-updated="true">Dec 13<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/devops/'>DevOps</a>, <a class='category' href='/blog/categories/digitalocean/'>DigitalOcean</a>, <a class='category' href='/blog/categories/linux/'>Linux</a>, <a class='category' href='/blog/categories/security/'>Security</a>, <a class='category' href='/blog/categories/virtual-servers/'>Virtual Servers</a>, <a class='category' href='/blog/categories/workflow/'>Workflow</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://www.alexbaban.com/blog/2013/12/13/securing-a-digitalocean-cloud-server/" data-via="" data-counturl="http://www.alexbaban.com/blog/2013/12/13/securing-a-digitalocean-cloud-server/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/12/09/using-livereload-and-livereloadx-on-windows-free-solution/" title="Previous Post: Using LiveReload and LiveReloadX on Windows - free solution">&laquo; Using LiveReload and LiveReloadX on Windows - free solution</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/12/13/securing-a-digitalocean-cloud-server/">Securing a DigitalOcean Cloud Server</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/09/using-livereload-and-livereloadx-on-windows-free-solution/">Using LiveReload and LiveReloadX on Windows - Free Solution</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/05/copy-as-path-for-windows-xp-or-later/">Copy as Path for Windows XP or Later</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/29/hello-world/">Hello World</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Alex Baban -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
